title: Detects SPAWNSNAIL SSH Backdoor
id: b2d5fd7a-8e1c-4e7b-a589-7f9dc4d64f1b
status: experimental
description: Detects SPAWNSNAIL, an SSH backdoor targeting Ivanti devices. It can inject a specified binary into other processes, run a local SSH backdoor when injected into the dsmdm process, and inject additional malware into dslogserver.
author: Mandiant (original YARA rule)
references:
  - md5: e7d24813535f74187db31d4114f607a1
logsource:
  category: process_creation
  product: linux
detection:
  selection_private_key:
    CommandLine|contains: 'PRIVATE KEY-----'
  selection_ssh_keys:
    CommandLine|contains:
      - '/id_ed25519'
      - '/id_ecdsa'
      - '/id_rsa'
  selection_selinux:
    CommandLine|contains:
      - '[selinux] enforce'
      - 'DSVersion::getReleaseStr()'
  selection_ssh_functions:
    CommandLine|contains:
      - 'ssh_set_server_callbacks'
      - 'ssh_handle_key_exchange'
      - 'ssh_add_set_channel_callbacks'
      - 'ssh_channel_close'
  condition: selection_private_key and 1 of selection_ssh_keys and 1 of selection_selinux and 1 of selection_ssh_functions
falsepositives:
  - Legitimate SSH key operations or system administration tasks
level: high
tags:
  - attack.persistence
  - attack.t1098

